version: 3
automerge: true
projects:
- name: root
  dir: .
  autoplan:
    when_modified: [
      "*.tf*",
      "modules/*/*.tf",
    ]
  workflow: myworkflow
- name: another-floor
  dir: another-floor/
  autoplan:
    when_modified: [
      "*.tf*",
      "../modules/*/*.tf",
    ]
  workflow: myworkflow
- name: yet-another-floor
  dir: yet-another-floor/
  autoplan:
    when_modified: [
      "*.tf*",
      "../modules/*/*.tf",
    ]
  workflow: myworkflow
workflows:
  myworkflow:
    plan:
      steps:
      - init
      - run: terraform fmt -check -diff
      - plan
    apply:
      steps:
      - run: echo hi
      - apply
